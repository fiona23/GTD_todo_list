/*!GTD_Tool 2015-06-27
* created by fiona23
*/
define(["util","init","defaults","categoryData","todoData"],function(a,b,c,d,e){var f=window.localStorage;return operateCategory={addCategory:function(){var e={};a("#"+c.cateOverlay)[0].style.display="block",f.getItem("cateNum")||f.setItem("cateNum",0),a.on("#"+c.addCateSub,"click",function(){if(a("#"+c.addCateName)){f.setItem("cateNum",parseInt(f.getItem("cateNum"))+1);var g="category"+f.getItem("cateNum");e.id="category"+f.getItem("cateNum"),e.name=a("#"+c.addCateName)[0].value,d[g]=e,f.setItem("categoryData",JSON.stringify(d)),a("#"+c.cateOverlay)[0].style.display="none",a("#"+c.addCateName)[0].value="",b.showCategory(),a.un("#"+c.addCateSub,"click")}})},deleteCategory:function(a,c){var g=confirm("删除目录，该目录下的所有任务也会被删除，确定吗");if(g){var h=a.parentNode.parentNode,i=h.className.split(" ")[1],j=d[i].child;for(var k in j){var l=k;break}for(var m in e)e[m].className==l&&delete e[m];delete d[i],f.setItem("categoryData",JSON.stringify(d)),f.setItem("todoData",JSON.stringify(e)),console.log(b),b.showCategory(),b.showTaskList(),b.showTaskDetail()}},addCategoryLevel2:function(){if(a("#"+c.addCateL2Name)[0].value){for(var e=target.className.split(" "),g=e.length-1;g>=0;g--)if(/^category[0-9]+$/.test(e[g])){var h=(new Date).getTime();console.log(e[g]),d[e[g]].child||(d[e[g]].child={}),d[e[g]].child[h]={id:h,name:a("#"+c.addCateL2Name)[0].value},f.setItem("categoryData",JSON.stringify(d));break}a("#"+c.addCateL2Overlay)[0].style.display="none",a("#"+c.addCateL2Name)[0].value="",b.showCategory()}},deleteCategoryLevel2:function(){var a=confirm("删除目录，该目录下的所有任务也会被删除，确定吗");if(a){var c=target.className.split(" ")[0],g=target.className.split(" ")[2];delete d[g].child[c];for(var h in e)e[h].className==c&&delete e[h];f.setItem("categoryData",JSON.stringify(d)),f.setItem("todoData",JSON.stringify(e)),b.showCategory(),b.showTaskList(),b.showTaskDetail()}},showRightmenu:function(b){var d=b||window.event;return target=d.srcElement?d.srcElement:d.target,d.pageX||d.pageY?(posy=d.pageY,posx=d.pageX):(posx=d.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,posy=d.clientY+document.body.scrollTop+document.documentElement.scrollTop),2!==d.button?!1:(console.log(posy),a("#"+c.rightBtn)[0].style.display="block",a("#"+c.rightBtn)[0].style.left=posx-20+"px",a("#"+c.rightBtn)[0].style.top=posy-330+"px",void 0)}}});